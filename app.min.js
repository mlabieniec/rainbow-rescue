"use strict";class Collidable{constructor(){}}class Util{sounds={alert:"",bonus:"",chime:"",complete:"",finish:"",gameover:"",lose1:"","soundtrack-game":"","soundtrack-happy":"",success:"",transition:"",win:"",win2:""};preloaded=0;constructor(){}preload(){return new Promise(((e,t)=>{let o=Object.keys(this.sounds).length-1;for(let t in this.sounds){let l=new Audio(`sounds/${t}.mp3`);this.sounds[t]=l,l.addEventListener("canplaythrough",(t=>{if(this.preloaded>=o)return console.log("all sounds loaded"),e();console.log(`preloaded ${this.preloaded}/${o}`),this.preloaded++}))}}))}playSound(e){console.log("play: ",e),console.log(this.sounds[e]),this.sounds[e].play()}generateColor(){let e="ABCDEF0123456789",t="#";for(let o=0;o<6;o++){t+=e[Math.floor(Math.random()*e.length)]}return t}}class Ball extends Collidable{id;iDragging=!1;iSelected=!1;iDisabled=!1;onSelect;element;color;root;constructor(e){if(super(e),!e)throw Error("Ball requires a root element");this.root=e,this.element=document.createElement("div"),this.element.className="drag-box",this.id=Math.floor(1e4*Math.random())+1,this.element.addEventListener("click",this.setSelected.bind(this)),this.element.addEventListener("mouseover",this.toggleDrag.bind(this)),this.element.addEventListener("mouseout",this.toggleDrag.bind(this)),this.element.addEventListener("mousemove",this.move.bind(this)),e.appendChild(this.element)}popInFrom(e){this.element.style.top=e.element.style.top,this.element.style.left=e.element.style.left,setTimeout((()=>{this.setPosition()}),500)}setPosition(){let e=Math.abs(Math.random()*parseInt(this.root.offsetHeight))-30,t=Math.abs(Math.random()*parseInt(this.root.offsetWidth));this.element.style.top=e.toString()+"px",this.element.style.left=t.toString()+"px"}disable(){this.iDisabled=!0,this.element.style.cursor="default"}enable(){this.iDisabled=!1,this.element.style.cursor="pointer"}setColor(e){this.color=e,this.element.style.backgroundColor=e}getColor(){return this.element.style.backgroundColor}toggleDrag(){this.iDisabled||(this.iDragging=!this.iDragging,this.iDragging?this.element.style.cursor="crosshair":this.element.style.cursor="pointer")}move(e){if(this.iDragging&&!this.iDisabled){let t=parseInt(e.clientX)-50,o=parseInt(e.clientY)-50;this.element.style.top=`${o}px`,this.element.style.left=`${t}px`}}setSelected(){this.iDisabled||(this.iSelected=!this.iSelected,this.iSelected?(this.element.className="drag-box selected",this.onSelect&&this.onSelect(this)):this.element.className="drag-box")}clearSelected(){this.iSelected=!1,this.element.className="drag-box"}}document.body.onload=()=>{let e,t,o,l,n=20,s=25,r=[],i=0,a=0,c=[],d=15,m=15,h=15,u=0,g=u,p="rr",y=!0,f=!1,v=new Util,b=new Audio;const S=document.querySelector(".swatch"),C=document.getElementById("root"),E=document.getElementById("app"),I=document.querySelector(".timer"),x=document.querySelector(".score"),N=document.querySelector(".start"),k=document.querySelector(".btn-start"),w=document.getElementById("toolbar"),D=document.getElementById("username"),B=document.getElementById("gems");B.value=n;const L=document.querySelector(".high-score"),T=document.getElementById("gameOver"),M=document.querySelector(".gems"),q=document.querySelector(".btn-help");function $(){if(D.value){B.value&&(n=parseInt(B.value),s=n+n/2),M.textContent=n+"/"+s,clearInterval(l);try{g||F(p,{username:D.value,score:u,highscore:g})}catch(e){console.log(e)}m=15,d=15,N.className="start hidden",w.className="";for(let e=0;e<n;e++){let e=new Ball(C);e.onSelect=O,r.push(e),setTimeout((()=>{j()}),500)}I.textContent=d,x.textContent=u,L.textContent=g,H(),W("soundtrack-game")}}function O(l){G("chime"),l.disable(),c[i]=l,2===c.length?(t=c[i-1].color,l.setColor(t),function(l){let n;if(t===e){try{window.navigator.vibrate(200)}catch(e){console.log(e)}l[0].element.style.top=l[1].element.style.top,l[0].element.style.left=l[1].element.style.left,n="win",u++,a++,P(u),3===a?(u+=3,d=1,G("bonus"),m<h&&m++,f=!0):f=!1,setTimeout((()=>{l[0].element.className="drag-box destroy",setTimeout((()=>{r.forEach(((e,t)=>{if(e.id===l[0].id&&(C.removeChild(l[0].element),r.splice(t,1),U(),r.length<=2))return A()}))}),500)}),1e3)}else{n="lose1";let e=new Ball(C);e.onSelect=O,e.popInFrom(l[0]),r.push(e),U(),m--,console.log("gameTime: ",h),console.log("totalTime: ",m),console.log("gems: ",r.length),(m<=2||r.length>=s)&&(console.log("GAME OVER"),W("gameover"),T.className="game-over",d=m,clearInterval(o),r.forEach((e=>{root.innerHTML=""})),r=[],u=0)}G(n),x.textContent=u}(c),c=[],i=0):i++}function A(){G("finish"),d=m,u+=m,d=m,P(u),clearInterval(o),J(),r.forEach((e=>{root.removeChild(e.element)})),r=[]}function P(e){let t={username:D.value,score:e,highscore:g};return g<e&&(t.highscore=e),F(p,t)}function F(e,t){return localStorage.setItem(e,JSON.stringify(t)),JSON.parse(localStorage.getItem(e))}function J(){y=!0,w.className="hidden",T.className="game-over hidden";try{let e=JSON.parse(localStorage.getItem(p));D.value=e.username,L.textContent=e.highscore||e.score}catch(e){L.textContent="0",console.log(e)}E.style.backgroundColor=v.generateColor(),N.className="start",l=setInterval((()=>{let e=v.generateColor();N.style.border=`3px dashed ${e}`,L.style.color=e}),3e3),W("soundtrack-happy"),o&&clearInterval(o)}function W(e){b.src=`sounds/${e}.mp3`,b.loop=!0,b.play()}function j(){if(e&&(E.style.backgroundColor=e),2===r.length)return A();a=0,c=[],i=0,e=v.generateColor(),r.forEach(((t,o)=>{t.enable(),t.clearSelected(),t.setPosition();let l=v.generateColor();o<=3&&(l=e),t.color=l,t.setColor(l),t.element.className="drag-box animating",setTimeout((()=>{t.element.className="drag-box"}),1200)})),S.style.backgroundColor=e,y||f||G("complete"),y=!1,U()}function H(){o=setInterval((()=>{if(d--,I.textContent=d,0===d)d=m,clearInterval(o),j(),y||H();else if(r.length<=2)return A()}),1e3)}function U(){M.textContent=r.length+" / "+s}function G(e){try{v.playSound(e)}catch(e){console.log(e)}}S.addEventListener("click",j),k.addEventListener("click",(e=>{e.preventDefault(),D.value&&$()})),T.addEventListener("click",J),q.addEventListener("click",(()=>{"hidden"==document.getElementById("helpText").className?document.getElementById("helpText").className="":document.getElementById("helpText").className="hidden"})),v.preload().then(J)},"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js")}));
