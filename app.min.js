"use strict";class Collidable{constructor(){}}class Util{constructor(){}static generateColor(){let e="ABCDEF0123456789",t="#";for(let o=0;o<6;o++){t+=e[Math.floor(Math.random()*e.length)]}return t}}class Ball extends Collidable{id;iDragging=!1;iSelected=!1;iDisabled=!1;onSelect;element;color;root;constructor(e){if(super(e),!e)throw Error("Ball requires a root element");this.root=e,this.element=document.createElement("div"),this.element.className="drag-box",this.id=Math.floor(1e4*Math.random())+1,this.element.addEventListener("click",this.setSelected.bind(this)),this.element.addEventListener("mouseover",this.toggleDrag.bind(this)),this.element.addEventListener("mouseout",this.toggleDrag.bind(this)),this.element.addEventListener("mousemove",this.move.bind(this)),e.appendChild(this.element)}popInFrom(e){this.element.style.top=e.element.style.top,this.element.style.left=e.element.style.left,setTimeout((()=>{this.setPosition()}),500)}setPosition(){let e=Math.abs(Math.random()*parseInt(this.root.offsetHeight))-30,t=Math.abs(Math.random()*parseInt(this.root.offsetWidth));this.element.style.top=e.toString()+"px",this.element.style.left=t.toString()+"px"}disable(){this.iDisabled=!0,this.element.style.cursor="default"}enable(){this.iDisabled=!1,this.element.style.cursor="pointer"}setColor(e){this.color=e,this.element.style.backgroundColor=e}getColor(){return this.element.style.backgroundColor}toggleDrag(){this.iDisabled||(this.iDragging=!this.iDragging,this.iDragging?this.element.style.cursor="crosshair":this.element.style.cursor="pointer")}move(e){if(this.iDragging&&!this.iDisabled){let t=parseInt(e.clientX)-50,o=parseInt(e.clientY)-50;this.element.style.top=`${o}px`,this.element.style.left=`${t}px`}}setSelected(){this.iDisabled||(this.iSelected=!this.iSelected,this.iSelected?(this.element.className="drag-box selected",this.onSelect&&this.onSelect(this)):this.element.className="drag-box")}clearSelected(){this.iSelected=!1,this.element.className="drag-box"}}"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js")})),document.body.onload=()=>{let e,t,o,l,n=20,s=25,r=[],a=0,i=0,c=[],d=15,m=15,h=15,u=0,g=u,y="rr",p=!0,f=["alert","bonus","chime","complete","finish","gameover","lose1","soundtrack-game","soundtrack-happy","success","transition","win","win2"];const v=document.querySelector(".swatch"),b=document.getElementById("root"),E=document.getElementById("app"),S=document.querySelector(".timer"),C=document.querySelector(".score"),I=document.querySelector(".start"),x=document.querySelector(".btn-start"),N=document.getElementById("toolbar"),k=document.getElementById("username"),D=document.getElementById("gems");D.value=n;const B=document.querySelector(".high-score"),w=document.getElementById("gameOver"),T=document.createElement("audio"),L=document.createElement("audio");L.autoplay=!0;const M=document.querySelector(".gems"),q=document.querySelector(".btn-help");function $(){if(k.value){D.value&&(n=parseInt(D.value),s=n+n/2),M.textContent=n+"/"+s,clearInterval(l);try{g||F(y,{username:k.value,score:u,highscore:g})}catch(e){console.log(e)}m=15,d=15,I.className="start hidden",N.className="";for(let e=0;e<n;e++){let e=new Ball(b);e.onSelect=O,r.push(e),setTimeout((()=>{A()}),500)}S.textContent=d,C.textContent=u,B.textContent=g,H(),W("soundtrack-game")}}function O(l){G("chime"),l.disable(),c[a]=l,2===c.length?(t=c[a-1].color,l.setColor(t),function(l){let n;if(t===e){try{window.navigator.vibrate(200)}catch(e){console.log(e)}l[0].element.style.top=l[1].element.style.top,l[0].element.style.left=l[1].element.style.left,n="win",u++,i++,P(u),3===i&&(u+=3,d=1,G("bonus"),m<h&&m++),setTimeout((()=>{l[0].element.className="drag-box destroy",setTimeout((()=>{r.forEach(((e,t)=>{if(e.id===l[0].id&&(b.removeChild(l[0].element),r.splice(t,1),j(),r.length<=2))return U()}))}),500)}),1e3)}else{n="lose1";let e=new Ball(b);e.onSelect=O,e.popInFrom(l[0]),r.push(e),j(),m--,console.log("gameTime: ",h),console.log("totalTime: ",m),console.log("gems: ",r.length),(m<=2||r.length>=s)&&(console.log("GAME OVER"),W("gameover"),w.className="game-over",d=m,clearInterval(o),r.forEach((e=>{root.innerHTML=""})),r=[],u=0)}G(n),C.textContent=u}(c),c=[],a=0):a++}function U(){G("finish"),d=m,u+=m,d=m,P(u),clearInterval(o),J(),r.forEach((e=>{root.removeChild(e.element)})),r=[]}function P(e){let t={username:k.value,score:e,highscore:g};return g<e&&(t.highscore=e),F(y,t)}function F(e,t){return localStorage.setItem(e,JSON.stringify(t)),JSON.parse(localStorage.getItem(e))}function J(){p=!0,N.className="hidden",w.className="game-over hidden";try{let e=JSON.parse(localStorage.getItem(y));k.value=e.username,B.textContent=e.highscore||e.score}catch(e){B.textContent="0",console.log(e)}E.style.backgroundColor=Util.generateColor(),I.className="start",l=setInterval((()=>{let e=Util.generateColor();I.style.border=`3px dashed ${e}`,B.style.color=e}),3e3),W("soundtrack-happy"),o&&clearInterval(o)}function W(e){T.src=`sounds/${e}.mp3`,T.loop=!0,T.autoplay=!0}function A(){if(e&&(E.style.backgroundColor=e),2===r.length)return U();i=0,c=[],a=0,e=Util.generateColor(),r.forEach(((t,o)=>{t.enable(),t.clearSelected(),t.setPosition();let l=Util.generateColor();o<=3&&(l=e),t.color=l,t.setColor(l),t.element.className="drag-box animating",setTimeout((()=>{t.element.className="drag-box"}),1200)})),v.style.backgroundColor=e,G("complete"),p=!1,j()}function H(){o=setInterval((()=>{if(d--,S.textContent=d,0===d)d=m,clearInterval(o),A(),p||H();else if(r.length<=2)return U()}),1e3)}function j(){M.textContent=r.length+" / "+s}function G(e){try{return L.src=`sounds/${e}.mp3`,!0}catch(e){return console.log(e),!1}}v.addEventListener("click",A),x.addEventListener("click",(e=>{e.preventDefault(),k.value&&$()})),w.addEventListener("click",J),q.addEventListener("click",(()=>{"hidden"==document.getElementById("helpText").className?document.getElementById("helpText").className="":document.getElementById("helpText").className="hidden"})),new Promise(((e,t)=>{let o=0;f.forEach((l=>{const n=document.createElement("audio");n.src=`sounds/${l}.mp3`,n.onloadeddata=function(t){if(o++,console.log("loaded sound: ",l),o>=f.length)return console.log("all sounds loaded"),e()},n.onerror=function(e){return t()}}))})).then(J)};
